<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>常時表示火山AR</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: black; }
        
        /* UIパネル */
        .ui-panel {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: rgba(0,0,0,0.8);
            padding: 15px; border-radius: 15px; color: white; z-index: 9999; 
            text-align: center; border: 2px solid white;
        }
        
        .btn-group { display: flex; gap: 5px; margin-bottom: 10px; }
        button {
            flex: 1; padding: 10px 0; border: none; border-radius: 8px; 
            font-weight: bold; cursor: pointer; background: #666; color: white;
        }
        button.active { background: #ff9800; color: black; }
        .btn-erupt { background: #d32f2f; width: 100%; font-size: 16px; padding: 12px 0; }
        
        /* 背景映像用 */
        #cam-video {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1;
        }
    </style>
</head>

<body>
    <video id="cam-video" autoplay playsinline muted></video>

    <div class="ui-panel">
        <div style="margin-bottom:10px; font-size:14px;">火山の種類を選択</div>
        <div class="btn-group">
            <button class="active" onclick="show('dome', this)">ドーム状</button>
            <button onclick="show('strato', this)">成層</button>
            <button onclick="show('shield', this)">楯状</button>
        </div>
        <button class="btn-erupt" id="btn-action" onclick="toggleErupt()">噴火させる！</button>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false" 
             renderer="alpha: true; antialias: true; colorManagement: true;">
        
        <a-entity camera look-controls="enabled: false">
            
            <a-entity id="volcano-group" position="0 -0.5 -2.5">
                
                <a-entity id="dome" visible="true">
                    <a-sphere color="#8d6e63" radius="0.6"></a-sphere>
                    <a-text value="Dome" position="0 0.8 0" align="center" color="white"></a-text>
                </a-entity>

                <a-entity id="strato" visible="false">
                    <a-cone color="#546e7a" radius-bottom="0.8" height="1.2"></a-cone>
                    <a-text value="Strato" position="0 0.8 0" align="center" color="white"></a-text>
                </a-entity>

                <a-entity id="shield" visible="false">
                    <a-cylinder color="#3e2723" radius="1.0" height="0.2"></a-cylinder>
                    <a-cone color="#3e2723" radius-bottom="1.0" height="0.3" position="0 0.1 0"></a-cone>
                    <a-text value="Shield" position="0 0.5 0" align="center" color="white"></a-text>
                </a-entity>

                <a-sphere id="fire" color="red" radius="0.2" position="0 0.5 0" visible="false"></a-sphere>

            </a-entity> </a-entity>
    </a-scene>

    <script>
        // カメラ起動スクリプト
        const video = document.getElementById('cam-video');
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                .then(stream => {
                    video.srcObject = stream;
                    video.play();
                })
                .catch(e => {
                    alert("カメラエラー: " + e);
                });
        }

        // 火山切り替え
        function show(type, btn) {
            ['dome', 'strato', 'shield'].forEach(id => {
                document.getElementById(id).setAttribute('visible', false);
            });
            document.getElementById(type).setAttribute('visible', true);
            
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // 噴火位置調整
            const fire = document.getElementById('fire');
            fire.setAttribute('visible', false);
            document.getElementById('btn-action').innerText = "噴火させる！";
            
            if(type === 'dome') fire.setAttribute('position', '0 0.6 0');
            if(type === 'strato') fire.setAttribute('position', '0 0.6 0');
            if(type === 'shield') fire.setAttribute('position', '0 0.3 0');
        }

        // 噴火アニメーション
        function toggleErupt() {
            const fire = document.getElementById('fire');
            const isVis = fire.getAttribute('visible');
            fire.setAttribute('visible', !isVis);
            
            document.getElementById('btn-action').innerText = isVis ? "噴火させる！" : "とめる";

            if (!isVis) {
                // 手動アニメーション
                let s = 1;
                let y = fire.getAttribute('position').y;
                const anim = setInterval(() => {
                    if(fire.getAttribute('visible') === false) { clearInterval(anim); return; }
                    s = s === 1 ? 1.5 : 1;
                    fire.setAttribute('scale', `${s} ${s} ${s}`);
                }, 200);
            }
        }
    </script>
</body>
</html>
