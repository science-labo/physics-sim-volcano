<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>çµ¶å¯¾ã«è¦‹ãˆã‚‹ç«å±±AR</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background-color: black; }
        
        /* UIãƒ‘ãƒãƒ« */
        .ui-panel {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 90%; max-width: 400px; background: rgba(0,0,0,0.85);
            padding: 15px; border-radius: 15px; color: white; z-index: 2000; text-align: center;
            border: 1px solid #555;
        }
        
        .btn-group { display: flex; gap: 8px; margin-bottom: 10px; }
        .btn-main {
            flex: 1; padding: 12px 5px; border: none; border-radius: 8px; font-size: 11px;
            font-weight: bold; background: #444; color: white; transition: 0.2s;
        }
        .btn-main.active { background: #ff9800; color: black; }
        
        .btn-action {
            width: 100%; padding: 12px; margin-top: 5px;
            font-size: 16px; font-weight: bold; border: none; border-radius: 8px;
            background: #f44336; color: white;
        }

        /* æ•‘æ¸ˆãƒœã‚¿ãƒ³ï¼šç”»é¢ä¸Šéƒ¨ã«é…ç½® */
        #reset-btn {
            position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
            padding: 10px 20px; background: #00bcd4; color: white;
            border: none; border-radius: 30px; font-weight: bold;
            box-shadow: 0 0 15px rgba(0,255,255,0.5); z-index: 2000;
            display: flex; align-items: center; gap: 5px;
        }

        #volcano-desc { font-size: 13px; margin-bottom: 10px; min-height: 2.5em; }
    </style>
</head>

<body>
    <video id="webcam" autoplay playsinline style="position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; z-index:-1;"></video>

    <button id="reset-btn" onclick="placeInFront()">
        <span>ğŸ“ ç«å±±ã‚’ç›®ã®å‰ã«å‘¼ã¶</span>
    </button>

    <div class="ui-panel">
        <div id="volcano-desc">ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ç«å±±ã‚’é¸ã‚“ã§ãã ã•ã„</div>
        <div class="btn-group">
            <button class="btn-main" onclick="setVolcano('dome', this)">ãƒ‰ãƒ¼ãƒ çŠ¶</button>
            <button class="btn-main" onclick="setVolcano('strato', this)">æˆå±¤ç«å±±</button>
            <button class="btn-main" onclick="setVolcano('shield', this)">æ¥¯çŠ¶ç«å±±</button>
        </div>
        <button class="btn-action" id="erupt-btn" onclick="toggleEruption()">ğŸ”¥ å™´ç«ã•ã›ã‚‹</button>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false">
        
        <a-entity id="camera-rig" position="0 0 0">
            <a-entity id="head" camera look-controls position="0 1.6 0"></a-entity>
        </a-entity>

        <a-light type="ambient" intensity="0.7"></a-light>
        <a-light type="directional" position="-1 2 1" intensity="0.8"></a-light>

        <a-entity id="volcano-wrapper" position="0 1.6 -3">
            
            <a-entity id="dome" visible="false">
                <a-sphere radius="0.5" color="#8d6e63" position="0 0 0"></a-sphere>
                <a-cone radius-bottom="0.6" height="0.4" color="#5d4037" position="0 -0.2 0"></a-cone>
                <a-text value="Dome (Sticky)" position="0 1 0" align="center" scale="2 2 2"></a-text>
            </a-entity>

            <a-entity id="strato" visible="false">
                <a-cone radius-bottom="0.8" radius-top="0.1" height="1.5" color="#546e7a" position="0 0 0"></a-cone>
                <a-text value="Strato (Standard)" position="0 1.2 0" align="center" scale="2 2 2"></a-text>
            </a-entity>

            <a-entity id="shield" visible="false">
                <a-cylinder radius="1.2" height="0.2" color="#3e2723" position="0 0 0"></a-cylinder>
                <a-cone radius-bottom="1.2" height="0.3" color="#3e2723" position="0 0.1 0"></a-cone>
                <a-text value="Shield (Fluid)" position="0 0.8 0" align="center" scale="2 2 2"></a-text>
            </a-entity>

            <a-entity id="eruption" visible="false" position="0 0.8 0">
                <a-sphere color="#ff3d00" radius="0.15">
                    <a-animation attribute="position" to="0 2 0" dur="1000" repeat="indefinite"></a-animation>
                    <a-animation attribute="scale" from="1 1 1" to="3 3 3" dur="1000" repeat="indefinite" easing="ease-out"></a-animation>
                    <a-animation attribute="material.opacity" from="1" to="0" dur="1000" repeat="indefinite"></a-animation>
                </a-sphere>
            </a-entity>

        </a-entity>
    </a-scene>

    <script>
        // ã‚«ãƒ¡ãƒ©èµ·å‹•å‡¦ç†
        const video = document.getElementById('webcam');
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            navigator.mediaDevices.getUserMedia({ video: { facingMode: { ideal: "environment" } } })
                .then(stream => { video.srcObject = stream; })
                .catch(err => { 
                    alert("ã‚«ãƒ¡ãƒ©ã‚¨ãƒ©ãƒ¼: " + err.name); 
                    console.error(err);
                });
        }

        // åˆæœŸè¨­å®šï¼šæœ€åˆã¯æˆå±¤ç«å±±ã‚’è¡¨ç¤ºã—ã¦ãŠã
        window.onload = function() {
            setVolcano('strato', document.querySelectorAll('.btn-main')[1]);
        };

        // ç«å±±åˆ‡ã‚Šæ›¿ãˆ
        function setVolcano(type, btn) {
            // å…¨éè¡¨ç¤º
            ['dome', 'strato', 'shield'].forEach(id => {
                document.getElementById(id).setAttribute('visible', false);
            });
            // é¸æŠã—ãŸã‚‚ã®ã‚’è¡¨ç¤º
            document.getElementById(type).setAttribute('visible', true);
            
            // èª¬æ˜æ–‡æ›´æ–°
            const texts = {
                dome: "ã€ãƒ‰ãƒ¼ãƒ çŠ¶ã€‘ç²˜ã‚Šæ°—ãŒå¼·ãã€ç››ã‚Šä¸ŠãŒã£ãŸå½¢",
                strato: "ã€æˆå±¤ç«å±±ã€‘ãƒãƒ©ãƒ³ã‚¹ã®è‰¯ã„ä¸‰è§’ã®å±±",
                shield: "ã€æ¥¯çŠ¶ç«å±±ã€‘ã‚µãƒ©ã‚µãƒ©æº¶å²©ã§å¹³ã¹ã£ãŸã„"
            };
            document.getElementById('volcano-desc').innerText = texts[type];

            // ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³æ›´æ–°
            document.querySelectorAll('.btn-main').forEach(b => b.classList.remove('active'));
            if(btn) btn.classList.add('active');

            // å™´ç«ä½ç½®èª¿æ•´
            const erup = document.getElementById('eruption');
            if(type === 'dome') erup.setAttribute('position', '0 0.6 0');
            if(type === 'strato') erup.setAttribute('position', '0 0.8 0');
            if(type === 'shield') erup.setAttribute('position', '0 0.3 0');
        }

        // å™´ç«åˆ‡ã‚Šæ›¿ãˆ
        function toggleEruption() {
            const el = document.getElementById('eruption');
            const isVis = el.getAttribute('visible');
            el.setAttribute('visible', !isVis);
            document.getElementById('erupt-btn').innerText = !isVis ? "â–  å™´ç«ã‚’æ­¢ã‚ã‚‹" : "ğŸ”¥ å™´ç«ã•ã›ã‚‹";
        }

        // â˜…æœ€é‡è¦ï¼šç«å±±ã‚’å¼·åˆ¶çš„ã«ç›®ã®å‰ã«æŒã£ã¦ãã‚‹é–¢æ•°
        function placeInFront() {
            const cameraEl = document.getElementById('head');
            const volcanoWrapper = document.getElementById('volcano-wrapper');
            
            // ã‚«ãƒ¡ãƒ©ã®ç¾åœ¨ã®å›è»¢æƒ…å ±ã‚’å–å¾—
            const rotation = cameraEl.getAttribute('rotation');
            
            // ã‚«ãƒ¡ãƒ©ã®å‘ãã«åˆã‚ã›ã¦ã€å°‘ã—å‰æ–¹(-3m)ã«é…ç½®ã™ã‚‹è¨ˆç®—
            // A-Frameã®ã‚·ãƒ³ãƒ—ãƒ«ãªè¦ªå­é–¢ä¿‚ã‚’åˆ©ç”¨ã›ãšã€ã‚ãˆã¦è§’åº¦ã ã‘å–å¾—ã—ã¦é…ç½®ã—ãªãŠã™ç°¡æ˜“ç‰ˆ
            
            // ç¾åœ¨ã®Yè»¸ã®å›è»¢ï¼ˆå·¦å³ã®å‘ãï¼‰ã‚’å–å¾—
            const yRotation = rotation.y;
            
            // ãƒ©ã‚¸ã‚¢ãƒ³ã«å¤‰æ›
            const rad = yRotation * (Math.PI / 180);
            
            // æ–°ã—ã„ä½ç½®ã‚’è¨ˆç®— (ã‚«ãƒ¡ãƒ©ã®ä½ç½® 0,1.6,0 ã‚’åŸºæº–ã«)
            // sin/cosã‚’ä½¿ã£ã¦ã€Œå‘ã„ã¦ã„ã‚‹æ–¹å‘ã®3ãƒ¡ãƒ¼ãƒˆãƒ«å…ˆã€ã‚’è¨ˆç®—
            const dist = 3;
            const newX = -Math.sin(rad) * dist;
            const newZ = -Math.cos(rad) * dist;
            
            // ä½ç½®ã¨å›è»¢ã‚’é©ç”¨
            volcanoWrapper.setAttribute('position', `${newX} 1.6 ${newZ}`);
            volcanoWrapper.setAttribute('rotation', `0 ${yRotation} 0`);
            
            alert("ç«å±±ã‚’ç›®ã®å‰ã«ç§»å‹•ã—ã¾ã—ãŸï¼");
        }
    </script>
</body>
</html>
