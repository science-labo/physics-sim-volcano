<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ç«å±±ARï¼šè¨ºæ–­ãƒ¢ãƒ¼ãƒ‰</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #000; font-family: sans-serif; }

        /* â– UIãƒ‘ãƒãƒ«ï¼ˆçµ¶å¯¾ã«éš ã‚Œãªã„ã‚ˆã†ã« z-index ã‚’éå¸¸ã«å¤§ããè¨­å®šï¼‰ */
        .ui-container {
            position: fixed; bottom: 20px; left: 0; width: 100%;
            display: flex; flex-direction: column; align-items: center;
            z-index: 999999 !important; /* æœ€å‰é¢æŒ‡å®š */
            pointer-events: none; /* ä¸‹ã®ãƒœã‚¿ãƒ³ä»¥å¤–ã¯ã‚¿ãƒƒãƒã‚’ã‚¹ãƒ«ãƒ¼ */
        }
        
        .control-panel {
            background: rgba(0, 0, 0, 0.8);
            padding: 15px; border-radius: 15px; width: 90%; max-width: 400px;
            pointer-events: auto; /* ã“ã“ã ã‘ã‚¿ãƒƒãƒæœ‰åŠ¹ */
            border: 2px solid cyan;
        }

        /* ãƒœã‚¿ãƒ³ã®ãƒ‡ã‚¶ã‚¤ãƒ³ */
        .btn-row { display: flex; gap: 10px; margin-bottom: 10px; }
        button {
            flex: 1; padding: 12px; border: none; border-radius: 8px;
            background: #555; color: white; font-weight: bold; font-size: 14px;
        }
        button.active { background: #ff9800; color: black; }
        
        /* å¾©æ´»ã•ã›ãŸé’ã„ãƒœã‚¿ãƒ³ï¼ˆãƒªã‚»ãƒƒãƒˆç”¨ï¼‰ */
        #reset-btn {
            background: #00bcd4; color: white; width: 100%; margin-top: 5px;
            padding: 12px; font-size: 16px;
        }

        /* â– è¨ºæ–­ãƒ­ã‚°ï¼ˆç”»é¢å·¦ä¸Šã«çŠ¶æ³ã‚’è¡¨ç¤ºï¼‰ */
        #debug-log {
            position: fixed; top: 10px; left: 10px;
            background: rgba(255, 255, 0, 0.9); color: black;
            padding: 5px; font-size: 12px; max-width: 300px;
            z-index: 999999 !important; border: 1px solid red;
        }

        /* ã‚«ãƒ¡ãƒ©æ˜ åƒï¼ˆèƒŒæ™¯ï¼‰ */
        #bg-video {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            object-fit: cover; z-index: -1;
        }
    </style>
</head>

<body>
    <div id="debug-log">ã‚·ã‚¹ãƒ†ãƒ æº–å‚™ä¸­...</div>

    <video id="bg-video" autoplay playsinline muted></video>

    <div class="ui-container">
        <div class="control-panel">
            <div style="color:white; margin-bottom:10px; text-align:center;">ç«å±±ã®ç¨®é¡</div>
            <div class="btn-row">
                <button onclick="setMode('dome', this)">ãƒ‰ãƒ¼ãƒ çŠ¶</button>
                <button onclick="setMode('strato', this)">æˆå±¤</button>
                <button onclick="setMode('shield', this)">æ¥¯çŠ¶</button>
            </div>
            <button id="reset-btn" onclick="location.reload()">ğŸ”„ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™</button>
        </div>
    </div>

    <a-scene embedded vr-mode-ui="enabled: false">
        
        <a-entity camera look-controls="enabled: false">
            
            <a-entity id="volcano-wrapper" position="0 -0.5 -3">
                
                <a-box id="test-box" color="red" position="0 1 0" scale="0.5 0.5 0.5">
                    <a-animation attribute="rotation" to="0 360 0" dur="2000" repeat="indefinite"></a-animation>
                </a-box>

                <a-sphere id="dome" radius="0.7" color="#8d6e63" visible="false"></a-sphere>
                
                <a-cone id="strato" radius-bottom="0.8" height="1.5" color="#546e7a" visible="false"></a-cone>
                
                <a-cylinder id="shield" radius="1.2" height="0.3" color="#3e2723" visible="false"></a-cylinder>

            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        // ãƒ­ã‚°å‡ºåŠ›é–¢æ•°
        function log(msg) {
            const d = document.getElementById('debug-log');
            d.innerHTML += "<br>" + msg;
            console.log(msg);
        }

        window.onload = function() {
            log("1. ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†");

            // ã‚«ãƒ¡ãƒ©èµ·å‹•
            const video = document.getElementById('bg-video');
            if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
                navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
                .then(stream => {
                    video.srcObject = stream;
                    log("2. ã‚«ãƒ¡ãƒ©æ˜ åƒå–å¾— OK");
                })
                .catch(err => {
                    log("â˜…ã‚¨ãƒ©ãƒ¼: ã‚«ãƒ¡ãƒ©èµ·å‹•å¤±æ•— " + err);
                    alert("ã‚«ãƒ¡ãƒ©ãŒèµ·å‹•ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\nè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚");
                });
            } else {
                log("â˜…ã‚¨ãƒ©ãƒ¼: ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã‚«ãƒ¡ãƒ©éå¯¾å¿œã§ã™");
            }

            // A-Frameç¢ºèª
            if (document.querySelector('a-scene')) {
                log("3. 3Dã‚¨ãƒ³ã‚¸ãƒ³(A-Frame) æº–å‚™OK");
            } else {
                log("â˜…ã‚¨ãƒ©ãƒ¼: 3Dã‚¨ãƒ³ã‚¸ãƒ³èª­ã¿è¾¼ã¿å¤±æ•—");
            }
        };

        // ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿
        function setMode(type, btn) {
            log("é¸æŠ: " + type);
            // ãƒ†ã‚¹ãƒˆç®±ã‚’æ¶ˆã™
            document.getElementById('test-box').setAttribute('visible', false);
            
            // å…¨ãƒ¢ãƒ‡ãƒ«éè¡¨ç¤º
            ['dome', 'strato', 'shield'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.setAttribute('visible', false);
            });

            // é¸æŠãƒ¢ãƒ‡ãƒ«è¡¨ç¤º
            const target = document.getElementById(type);
            if(target) target.setAttribute('visible', true);

            // ãƒœã‚¿ãƒ³è‰²å¤‰æ›´
            document.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }
        
        // ã‚¨ãƒ©ãƒ¼ç›£è¦–
        window.onerror = function(message, source, lineno, colno, error) {
            log("â˜…å†…éƒ¨ã‚¨ãƒ©ãƒ¼: " + message);
        };
    </script>
</body>
</html>
