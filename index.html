<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>火山ARシミュレーター</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        /* 画面が真っ白になるのを防ぐための設定 */
        body { margin: 0; overflow: hidden; background-color: #000; }
        .a-canvas { position: absolute; top: 0; left: 0; width: 100% !important; height: 100% !important; }
        
        .ui-panel {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            width: 85%; max-width: 350px; background: rgba(0,0,0,0.7);
            padding: 15px; border-radius: 15px; color: white; z-index: 9999; text-align: center;
            border: 1px solid rgba(255,255,255,0.3);
        }
        .btn-group { display: flex; gap: 5px; margin-bottom: 10px; }
        button {
            flex: 1; padding: 10px 5px; border: none; border-radius: 8px; font-size: 11px;
            font-weight: bold; background: #444; color: white; cursor: pointer;
        }
        button.active { background: #ff9800; }
        .btn-erupt { background: #f44336; width: 100%; font-size: 14px; }
        .desc { font-size: 12px; margin-bottom: 8px; height: 3em; display: flex; align-items: center; justify-content: center; }
    </style>
</head>

<body>
    <div class="ui-panel">
        <div id="info-desc" class="desc">ボタンを押して火山を出現させてください</div>
        <div class="btn-group">
            <button onclick="changeVolcano('dome', this)">ドーム状</button>
            <button onclick="changeVolcano('strato', this)">成層火山</button>
            <button onclick="changeVolcano('shield', this)">楯状火山</button>
        </div>
        <button id="erupt-btn" class="btn-erupt" onclick="toggleEruption()">噴火開始！</button>
    </div>

    <a-scene 
        embedded 
        vr-mode-ui="enabled: false"
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;">
        
        <a-entity id="volcano-anchor" position="0 -1 -3">
            <a-entity id="model-dome" visible="false">
                <a-sphere radius="0.7" scale="1 0.6 1" material="color: #888; roughness: 1;"></a-sphere>
                <a-text value="Dome" position="0 1 0" align="center"></a-text>
            </a-entity>
            <a-entity id="model-strato" visible="false">
                <a-cone radius-bottom="0.8" radius-top="0.05" height="1.5" material="color: #555;"></a-cone>
                <a-text value="Strato" position="0 1.8 0" align="center"></a-text>
            </a-entity>
            <a-entity id="model-shield" visible="false">
                <a-cylinder radius="1.5" height="0.3" material="color: #333;"></a-cylinder>
                <a-text value="Shield" position="0 0.8 0" align="center"></a-text>
            </a-entity>

            <a-entity id="lava" visible="false" position="0 0.5 0">
                <a-sphere radius="0.2" color="red">
                    <a-animation attribute="position" from="0 0 0" to="0 2 0" dur="500" repeat="indefinite"></a-animation>
                </a-sphere>
            </a-entity>
        </a-entity>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        function changeVolcano(type, btn) {
            // 全モデルを非表示
            ['dome', 'strato', 'shield'].forEach(t => {
                document.getElementById('model-' + t).setAttribute('visible', t === type);
            });
            // 説明文
            const txt = {dome:"ドーム状：ねばりけが強い", strato:"成層火山：ねばりけは中くらい", shield:"楯状：ねばりけが弱い"};
            document.getElementById('info-desc').innerText = txt[type];
            // ボタン選択状態
            document.querySelectorAll('.btn-group button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function toggleEruption() {
            const lava = document.getElementById('lava');
            const isVisible = lava.getAttribute('visible');
            lava.setAttribute('visible', !isVisible);
            document.getElementById('erupt-btn').innerText = !isVisible ? "停止" : "噴火開始！";
        }
    </script>
</body>
</html>
